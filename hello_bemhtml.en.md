# Hello, BEMHTML!

This guide will help you to try the BEMHTML template engine and understand its basic principles, after going seven simple steps.

## Step 1. Initialize project

Use the blank project from BEM developers:

````js
    $ git clone https://github.com/bem/project-stub.git project-hello
    $ cd project-hello
    $ npm install
````

That's what happens:

 - copying the blank project to the local directory project-hello;
 - local installing bem-tools (./project-hello/node_modules/.bin/bem);

<blockquote> NB: Required tools - utility bem (bem-tools) </blockquote>

`bem server` helps to organize the development cycle (edit - compile - view - edit ...).
You need to run it in the root folder of the project:

````js
    $ ./node_modules/.bin/bem server
````
The server listens at (http://localhost:8080/), and assembles pages on request from a browser, such as
(http://localhost:8080/desktop.bundles/index).

<blockquote> NB: At the first assembly to the project directory are copied the bemhtml and `bem-bl` libraries </blockquote>

### More

 - [Install bem-tools globally or locally](http://bem.info/tools/bem/installation/).

## Step 2. Create the page layout

Static layouts of HTML are placed in the `desktop.bundles` directory.

Create a blank page layout (let's name it `test`):

````js
    $ ./node_modules/.bin/bem create -l desktop.bundles -b test
````

<blockquote> NB: Language for description layouts of static pages (BEM-tree) - BEMJSON </blockquote>

Let's look at source code of page (desktop.bundles/test/test.bemjson.js):

````js
    ({
        block: 'b-page',
        title: 'test',
        head: [
            { elem: 'css', url: '_test.css', ie: false},
            { elem: 'css', url: '_test', ie: true },
            { block: 'i-jquery', elem: 'core'},
            { elem: 'js', url:'_test.js'},
        ],
        content: [
            'block content'
        ]
    })
````

### Here used:

 - `b-page` block from block library `bem-bl`.

<blockquote> NB: The project uses a library of blocks `bem-bl`, we can use and modify blocks from there </blockquote>

Review the results of assembly page in the browser: (http://localhost:8080/desktop.bundles/test/test.html)

### More

 - [BEMJSON docs (ru)](https://github.com/bem/bemhtml/blob/master/common.docs/reference/reference.ru.md#%D0%A1%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%81-bemjson)
 - [Bem-bl blocks library](http://bem.github.io/bem-bl/index.en.html)
 - [Bem-tools docs](http://ru.bem.info/tools/)

## Step 3. Add block

Let's create a very simple layout, which is just one block on the test page with the text "Hello, BEMHTML!".

Edit the source of BEMJSON (`desktop.bundles/test/test.bemjson.js`):

````js
    ({
        block: 'b-page',
        title: 'test',
        head: [
            { elem: 'css', url: '_test.css', ie: false},
            { elem: 'css', url: '_test', ie: true },
            { block: 'i-jquery', elem: 'core'},
            { elem: 'js', url:'_test.js'},
        ],
        content: [
                {
                    block: 'b-hello',
                    content: 'Hello, BEMHTML!'
                }
        ]
    })
````

### Here:

 - `b-hello` block placed at page content (content field of `b-page` block);
 - text of greetings in content field of `b-hello` block.

<blockquote> NB: If the block templates are not defined in the project, HTML generated by using standard templates from the library bemhtml </blockquote>

Look at the result. The fragment of HTML-code which describes the body of the page must look like this:

````js
    <body class="b-page__body b-page">
      <div class="b-hello">Hello, BEMHTML!</div>
    </body>
````

### Here:

 - `b-hello` block corresponds to a div;
 - attribute of class contains block name.

## Step 4. Write the template: greeting by pattern

Let's make the 'b-hello' block more universal, let it generates a greeting for the specified name.
By specifying a different name, you can use the same block `b-hello` on different pages or repeatedly on the same page.

<blockquote> NB: BEMJSON Objects may contain any data fields and templates can use these fields </blockquote>

Put the name in a specific for our block data field - name (edit test.bemjson.js):

````js
    { block: 'b-hello', name: 'BEMHTML' }
````

And to generate templated text greetings let's create the BEMHTML template.

Create `b-hello` block . Blocks that's defined at the project, located in the directory desktop.blocks:

````js
    $ ./node_modules/.bin/bem create -l desktop.blocks -b b-hello
````

Let's write a template for the `b-hello` block in the file desktop.blocks / b-hello / b-hello.bemhtml:

````js
    block b-hello, content: ['Hello, ', this.ctx.name, '!']
````

### Here:

 - block `b-hello`, content â€” predicate template (will invoked during the processing of block `b-hello` in standard mode content);
 - ['Hello, ', this.ctx.name, '!'] - template body (when outputting HTML, performed the concatenation of strings - the array elements);
 - this.ctx.name - context field, corresponds to the field name in the source BEMJSON block.

<blockquote> NB: Steps of generation HTML, are  not overridden in a custom template, will performed by standard templates of BEMHTML library. </blockquote>

HTML-result:

````js
    <body class="b-page__body b-page">
      <div class="b-hello">Hello, BEMHTML!</div>
    </body>
````

### More:

 - [BEMHTML docs. Syntax (ru)](https://github.com/bem/bemhtml/blob/master/common.docs/reference/reference.ru.md#%D0%A1%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%81-bemhtml)
 - [BEMHTML docs. Standard mods (ru)](https://github.com/bem/bemhtml/blob/master/common.docs/reference/reference.ru.md#%D0%A1%D1%82%D0%B0%D0%BD%D0%B4%D0%B0%D1%80%D1%82%D0%BD%D1%8B%D0%B5-%D0%BC%D0%BE%D0%B4%D1%8B)
 - [BEMHTML docs. Context fields (ru)](https://github.com/bem/bemhtml/blob/master/common.docs/reference/reference.ru.md#%D0%9F%D0%BE%D0%BB%D1%8F-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%B0)

## Step 5. Rewrite template: the generation of a list by element of array

With the development of project may need complicate the `b-hello` block, for example to display multiple greetings for the given list of names.

The most simple modification of the original data in this case - replace the name in the name field by array string  field names.
Now test.bemjson.js look's like this:

````js
    { block: 'b-hello', names: ['BEM', 'BEMJSON', 'BEMHTML'] }
````

Following the BEM-methodology, each greeting correctly represented as an element item, embedded in a block b-hello.
In other words, we would like to get a BEM-tree upon application template:

````js
    {
        block: 'b-hello',
        content: [
            { elem: 'item', content: 'BEM' },
            { elem: 'item', content: 'BEMJSON' },
            { elem: 'item', content: 'BEMHTML' }
        ]
    }
````

<blockquote> NB: BEMHTML-templates allow you to modify on the fly input BEMJSON (BEM-tree) </blockquote>

The task of template now is that for each name in the list generate an element item, embedded in the b-hello. File b-hello.bemhtml:

````js
    block b-hello {
        content: this.ctx.names.map(function(user) { return { elem: 'item', content: name } })

        elem item, content: ['Hello, ', applyNext(), '!']
    }
````

### Here in the body of the template used:

 - shorthand predicates using {}. Equivalent to the two templates with predicates: block b-hello, content, block b-hello, elem item, content;
 - templates by [content](https://github.com/bem/bemhtml/blob/master/common.docs/reference/reference.ru.md#content) mode;
 - construction [applyNext](https://github.com/bem/bemhtml/blob/master/common.docs/reference/reference.ru.md#applynext) - recursive call to use templates;
 - construction [Array.prototype.map](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/map), defined in the standard EcmaScript 5.

<blockquote> NB: In the predicate, and body template, you can use arbitrary JS-expressions </blockquote>

As a result of the use of templates we get a HTML-page with a block of three greetings:

````js
    <div class="b-hello">
        <div class="b-hello__item">Hello, BEM!</div>
        <div class="b-hello__item">Hello, BEMJSON!</div>
        <div class="b-hello__item">Hello, BEMHTML!</div>
    </div>
````

## Step 6. Supplement the template: modify HTML-tags

At first glance, the introduction of elements of the item may seem redundant,
but it can be useful to fully appreciate at the time when you want to make a block of greetings in the form of a bulleted list.

In this case, the modification BEMHTML-template would very simple: we only need to specify the correct tag for the
block b-hello and item elements instead of the default <div>. Template for the block and item templates for mode tag:

````js
    block b-hello {

        tag: 'ul'

        content: this.ctx.names.map(function(user) { return { elem: 'item', content: name } })

        elem item {

            tag: 'li'

            content: ['Hello, ', applyNext(), '!']
        }
    }
````

### Here:

 - again used a nested record predicates, only four templates: block b-hello, tag, block b-hello, content, block b-hello,
     elem item, tag, block b-hello, elem item, content;
 - template by [tag](https://github.com/bem/bemhtml/blob/master/common.docs/reference/reference.ru.md#tag) mode.

<blockquote> NB: The number of templates in bemhtml-file equal to the number of colons separating the predicate of the template body </blockquote>

HTML-result:

````js
    <ul class="b-hello">
      <li class="b-hello__item">Hello, BEM!</li>
      <li class="b-hello__item">Hello, BEMJSON!</li>
      <li class="b-hello__item">Hello, BEMHTML!</li>
    </ul>
````

## Step 7. Decoration and behavior of block (CSS and JS)

When a block is created in the project project-stub default files were generated three technologies:

 - b-hello.bemhtml;
 - b-hello.css;
 - b-hello.js.

Implementation of the block in the CSS and JS is not part of a template engine BEMHTML, but is used in conjunction with it in any real project.

<blockquote> NB: BEMHTML places the names of BEM-entity in the attribute class HTML-elements. In CSS selectors are used only by the class. </blockquote>

For example, to paint all blocks greetings green, just write in the CSS block (desktop.blocks/b-hello/b-hello.css):

````js
    .b-hello
    {
        color: green
    }
````

To enable client-side JavaScript for the block you must define a template for a block in the mode [js](https://github.com/bem/bemhtml/blob/master/common.docs/reference/reference.ru.md#js):

````js
    block b-hello, js: true
````

If for block was initialized client JS, BEMHTML adds a list HTML-classes i-bem, and attribute with value of parameters client JS (default - onclick, see [jsAttr mode](https://github.com/bem/bemhtml/blob/master/common.docs/reference/reference.ru.md#jsattr)).
JS-framework during initialization adds HTML-class b-hello_js_inited:

````js
    <div class="b-hello i-bem b-hello_js_inited" onclick="return {&quot;b-hello&quot;:{}}">
````

<blockquote> NB: Block i-bem (part of the library bem-bl) - JS-Framework, which allows to write client-side JavaScript in BEM terms </blockquote>

Suppose, for example, when you click on the block a warning is displayed with the text Hello. File desktop.blocks / b-hello / b-hello.js:

````js
    BEM.DOM.decl('b-hello', {
        onSetMod: {
        'js': {
            'inited': function() {
                this.bindTo('click', function() { alert('Hello') });
                }
            }
        }
    })
````

### More:

 - [Description for JS-Framework i-bem.js](http://h.yandex.net/?http%3A%2F%2Fbem.github.com%2Fbem-bl%2Fsets%2Fcommon-desktop%2Fi-bem%2Fi-bem.ru.html)

### What read next

 - [BEMHTML docs](https://github.com/bem/bemhtml/blob/master/common.docs/reference/reference.ru.md)
 - [Blocks library bem-bl](http://bem.github.com/bem-bl/index.en.html)
 - [BEM methodology](http://bem.info/method/)
